///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  Defines various heightmap utilties & brushes:
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
toggleheightmapedit = [blendpaintmode 0; if $hmapedit [editface 1 -1] [hmapedit 1]]

currentbrush = 2
selectbrush = [
    currentbrush = ( + $currentbrush $arg1 )
    if (< $currentbrush 0) [ currentbrush = $_HM_BrushCount ]
    if (> $currentbrush $_HM_BrushCount) [ currentbrush = 0 ]

    do [brush_@currentbrush]
    echo "heightmap brush set to:" $currentbrushname
]


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  A brush has two parts:
//        brushmap: A 2D field that defines how the brush affects a heightmap.
//     brushhandle: A 2D vertex on the brushmap.
//                  This handle is a reference point on the brushmap which represents
//                  where the editing cursor is pointed at.

//  clearbrush                   : resets the brushmap
//  brushvert <x> <y> <value>    : set a point on the brushmap
//  brushx <x>                   : the x coordinate of the brushhandle
//  brushy <y>                   : the y coordinate of the brushhandle

_HM_BrushVerts = [
    loop y (listlen $arg1) [
        bv = (at $arg1 $y)
        loop x (listlen $bv) [
            brushvert $x $y (at $bv $x)
        ]
    ]
]
_HM_BrushHandle = [
    brushx $arg1
    brushy $arg2
]

_HM_BrushCount = -1
newbrush = [
    _HM_BrushCount = (+ $_HM_BrushCount 1)
    do [
        brush_@_HM_BrushCount = [
            currentbrushname = [@@@arg1]
            clearbrush
            @@(if (> $numargs 1) [result [_HM_BrushHandle @arg2 @arg3; _HM_BrushVerts [@@arg4]]])
        ]
    ]
]


//#############################################################################################################################################
newbrush "Circle 1-0" 0 0 [1]   // 0

newbrush "Circle 2-1" 2 2 [     // 1
    ""
    "0 0 1 "
    "0 1 2 1 "
    "0 0 1 "
]

newbrush "Circle 4-2-1" 2 2 [   // 2
    "0 0 1 "
    "0 1 2 1 "
    "1 2 4 2 1 "
    "0 1 2 1 "
    "0 0 1 "
]

newbrush "Square 3x3" 1 1 [     // 3
    "1 1 1 "
    "1 1 1 "
    "1 1 1 "
]

newbrush "Square 5x5" 2 2 [     // 4
    "1 1 1 1 1 "
    "1 1 1 1 1 "
    "1 1 1 1 1 "
    "1 1 1 1 1 "
    "1 1 1 1 1 "
]

newbrush "Square 7x7" 3 3 [     // 5
    "1 1 1 1 1 1 1 "
    "1 1 1 1 1 1 1 "
    "1 1 1 1 1 1 1 "
    "1 1 1 1 1 1 1 "
    "1 1 1 1 1 1 1 "
    "1 1 1 1 1 1 1 "
    "1 1 1 1 1 1 1 "
]

newbrush "Smooth 3x3" 1 1 [     // 6
    "0 0 0 "
    "0 "
    "0 "
]

newbrush "Smooth 5x5" 2 2 [     // 7
    "0 0 0 0 0 "
    "0 "
    "0 "
    "0 "
    "0 "
]

newbrush "Smooth 7x7" 3 3 [     // 8
    "0 0 0 0 0 0 0"
    "0 "
    "0 "
    "0 "
    "0 "
    "0 "
    "0 "
]

newbrush "Noise 25x25" 12 12 [  // 9
    "0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 "
    ""
    "0 0 0 0 0 0 0 1 0 1 0 0 0 0 0 0 0 0 0 0 1 1 0 1 "
    "0 0 0 0 0 1 0 0 0 1 0 0 0 0 1 0 1 0 0 1 0 0 2 2 "
    "0 0 0 0 1 1 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 1 1 "
    "0 0 0 0 0 1 0 0 0 0 0 2 0 0 0 0 1 0 0 0 1 1 0 0 1 "
    "0 0 1 0 0 0 1 0 1 1 0 0 0 0 1 0 0 1 0 0 0 0 2 "
    "0 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0 0 1 1 1 2 "
    "0 0 0 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 1 1 "
    "0 0 0 0 1 1 1 0 0 1 0 0 0 0 0 0 0 0 1 0 0 1 0 1 "
    "0 1 0 2 0 1 1 1 1 0 0 1 0 0 0 0 1 "
    "0 0 0 0 2 0 0 0 0 0 0 0 0 0 0 0 1 1 0 1 1 "
    "1 0 1 0 0 0 0 0 1 0 0 0 1 0 1 "
    "0 0 0 0 0 0 0 1 1 0 1 1 0 0 1 0 0 1 0 0 0 0 1 0 0 1 "
    "0 1 1 1 0 3 0 2 0 0 0 1 1 0 0 0 1 1 "
    "0 0 1 0 0 1 0 0 1 0 1 1 0 1 0 0 0 0 0 1 "
    "0 0 1 1 0 0 0 0 2 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 1 "
    "0 1 1 0 1 0 0 1 0 0 0 0 0 1 0 0 1 1 0 0 0 0 1 "
    "1 0 0 0 0 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 1 0 0 1 0 1 "
    "0 0 0 1 0 0 1 0 1 1 0 0 0 0 0 0 0 1 "
    "0 0 0 0 0 0 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 0 1 "
    "0 0 0 0 1 0 1 1 0 2 0 0 0 0 0 1 0 0 0 1 0 0 0 0 1 "
    "0 0 0 0 0 0 0 0 0 1 0 1 "
    "0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 "
]


do [brush_@currentbrush] // Initialize default brush.

